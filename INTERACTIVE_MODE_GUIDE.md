# 🔍 Интерактивный режим классификации

## Что это такое?

Улучшенный интерактивный режим позволяет вам **лично принимать решение** о категории для каждого сомнительного элемента, а система автоматически создаёт правила для будущей классификации.

## ✨ Преимущества

✅ **Правильная кодировка** - все русские символы отображаются корректно  
✅ **Удобный интерфейс** - пронумерованные категории, простой выбор  
✅ **Автоматическое создание правил** - ваши решения сохраняются в `rules.json`  
✅ **Статистика** - видно сколько элементов уже классифицировано  
✅ **Возможность пропустить** - можно пропустить сомнительные элементы  
✅ **Сохранение прогресса** - можно выйти в любой момент (q)  

## 🚀 Как использовать

### Базовое использование

```bash
.venv\Scripts\python.exe interactive_classify_improved.py --input "example/БЗ.doc"
```

### С указанием выходного файла

```bash
.venv\Scripts\python.exe interactive_classify_improved.py --input "example/БЗ.doc" --output result.xlsx
```

### С указанием файла правил

```bash
.venv\Scripts\python.exe interactive_classify_improved.py --input "bom.xlsx" --rules my_rules.json
```

## 📋 Процесс работы

### Шаг 1: Запуск

Скрипт выполняет первичную автоматическую классификацию и показывает статистику:

```
================================================================================
🔍 ИНТЕРАКТИВНЫЙ КЛАССИФИКАТОР BOM ФАЙЛОВ
================================================================================
📁 Входной файл: example/БЗ.doc
📄 Выходной файл: categorized.xlsx
📋 Файл правил: rules.json
================================================================================

⏳ Выполняю первичную классификацию...

📊 Статистика первичной классификации:
   ✅ Классифицировано: 68
   ❓ Требует уточнения: 60
```

### Шаг 2: Интерактивная классификация

Для каждого неклассифицированного элемента показывается:

```
────────────────────────────────────────────────────────────────────────────
Элемент 1 из 60:
────────────────────────────────────────────────────────────────────────────
📝 [А1] Многоканальная линия задержки МВОЛЗ-5-FC/APC
────────────────────────────────────────────────────────────────────────────

Выберите категорию:
   1. Резисторы
   2. Конденсаторы
   3. Дроссели/Катушки
   4. Микросхемы
   5. Разъемы
   6. Отладочные платы
   7. Оптические компоненты         <-- Выбираем 7
   8. СВЧ модули
   9. Кабели
  10. Модули питания
  11. Диоды/Индикаторы
  12. Наши разработки
  13. Другие компоненты
  14. ⏭️  Пропустить этот элемент

  0. ❌ Оставить нераспределенным
  q. 🚪 Выйти и сохранить

👉 Ваш выбор: 7
```

### Шаг 3: Автоматическое создание правила

После вашего выбора система автоматически создаёт правило:

```
✅ Правило создано! (всего новых правил: 1)
```

Правило добавляется в `rules.json`:

```json
{
  "contains": "Многоканальная линия задержки МВОЛЗ-5-FC/APC",
  "category": "optics"
}
```

### Шаг 4: Завершение

После классификации всех элементов (или выхода по `q`):

```
================================================================================
🎉 Интерактивная классификация завершена!
================================================================================
✅ Новых правил создано: 15

💾 Сохраняю результаты в categorized.xlsx...

🔄 Запускаю полную обработку с новыми правилами...
   Используйте команду:
   python split_bom.py --inputs "example/БЗ.doc" --xlsx "result.xlsx" --assign-json "rules.json" --combine
```

## ⌨️ Управление

| Ввод | Действие |
|------|----------|
| `1-14` | Выбрать категорию по номеру |
| `0` или `Enter` | Пропустить элемент (оставить нераспределенным) |
| `q` | Выйти и сохранить все созданные правила |
| `Ctrl+C` | Экстренный выход (правила всё равно сохранятся) |

## 🔄 Полный рабочий процесс

### 1. Первая обработка файла

Запустите обычную категоризацию чтобы увидеть что попало в "Не распределено":

```bash
.venv\Scripts\python.exe split_bom.py --inputs "myfile.xlsx" --xlsx result.xlsx --txt-dir result_txt --combine
```

### 2. Интерактивная классификация неопределенных элементов

```bash
.venv\Scripts\python.exe interactive_classify_improved.py --input "myfile.xlsx" --output result.xlsx --rules rules.json
```

Пройдитесь по всем сомнительным элементам и назначьте им категории.

### 3. Повторная обработка с новыми правилами

После создания правил запустите обработку снова:

```bash
.venv\Scripts\python.exe split_bom.py --inputs "myfile.xlsx" --xlsx result.xlsx --txt-dir result_txt --assign-json rules.json --combine
```

Теперь все элементы, для которых вы создали правила, будут автоматически классифицироваться!

### 4. Обработка новых файлов

При обработке новых файлов система будет использовать накопленные правила:

```bash
.venv\Scripts\python.exe split_bom.py --inputs "newfile.xlsx" --xlsx new_result.xlsx --assign-json rules.json --combine
```

## 💡 Советы

### 1. Создавайте правила постепенно
Не обязательно классифицировать все элементы за раз. Можете выйти (`q`) в любой момент, правила сохранятся.

### 2. Используйте "Пропустить" для сомнительных элементов
Если не уверены в категории, нажмите `0` или `Enter` чтобы пропустить элемент.

### 3. Проверяйте rules.json
После интерактивной классификации откройте `rules.json` и проверьте созданные правила. При необходимости можете отредактировать вручную.

### 4. Делайте резервные копии rules.json
Если накопили много правил, сделайте резервную копию файла:

```bash
copy rules.json rules_backup.json
```

### 5. Используйте разные файлы правил для разных проектов
Для каждого проекта можете создать свой файл правил:

```bash
.venv\Scripts\python.exe interactive_classify_improved.py --input "project_a.xlsx" --rules rules_project_a.json
.venv\Scripts\python.exe interactive_classify_improved.py --input "project_b.xlsx" --rules rules_project_b.json
```

## 📊 Пример сессии

```
🔍 ИНТЕРАКТИВНЫЙ КЛАССИФИКАТОР BOM ФАЙЛОВ
Входной файл: БЗ.doc
Требует уточнения: 60 элементов

[1/60] КЕФС.203729.063
👉 Выбор: 7 (Оптические компоненты)
✅ Правило создано!

[2/60] ф. Microwave Photonic Systems
👉 Выбор: 8 (СВЧ модули)
✅ Правило создано!

[3/60] Пустая строка
👉 Выбор: 0 (Пропустить)

[4/60] Тумблер ТВ69-2М
👉 Выбор: 13 (Другие компоненты)
✅ Правило создано!

... и так далее ...

🎉 Завершено! Создано 45 новых правил!
```

## 🔧 Технические детали

### Формат правил в rules.json

```json
[
  {
    "contains": "текст для поиска",
    "category": "имя_категории"
  },
  {
    "contains": "другой текст",
    "category": "другая_категория"
  }
]
```

### Доступные категории

| Ключ | Название |
|------|----------|
| `resistors` | Резисторы |
| `capacitors` | Конденсаторы |
| `inductors` | Дроссели/Катушки |
| `ics` | Микросхемы |
| `connectors` | Разъемы |
| `dev_boards` | Отладочные платы |
| `optics` | Оптические компоненты |
| `rf_modules` | СВЧ модули |
| `cables` | Кабели |
| `power_modules` | Модули питания |
| `diods` | Диоды/Индикаторы |
| `our_developments` | Наши разработки |
| `others` | Другие компоненты |

## ❓ FAQ

**Q: Можно ли редактировать rules.json вручную?**  
A: Да! Файл в формате JSON, можно редактировать любым текстовым редактором.

**Q: Что если правило сработало неправильно?**  
A: Откройте `rules.json`, найдите неправильное правило и удалите или исправьте его.

**Q: Правила работают для всех файлов?**  
A: Да, один файл `rules.json` можно использовать для всех ваших BOM файлов.

**Q: Можно ли использовать регулярные выражения?**  
A: Да, в `rules.json` можно добавить поле `"regex"` вместо `"contains"`:
```json
{
  "regex": "^[A-Z]\\d+",
  "category": "optics"
}
```

**Q: Сколько правил можно создать?**  
A: Неограниченно! Но рекомендуется периодически проверять и оптимизировать правила.

---

**Дата создания:** 03.10.2025  
**Версия:** 1.0.5  
**Автор:** AI Assistant

