# 🏗 Архитектура проекта BOM Categorizer

**BOM Categorizer** — это десктопное приложение для автоматической классификации электронных компонентов из спецификаций (BOM).

> **Версии:** Standard v3.3.0 (Tkinter) / Modern Edition v4.4.5 (PySide6)  
> **Язык:** Python 3.13+  
> **Архитектура:** Модульный пайплайн (Pipeline)

---

## 💡 Основные идеи и принципы

Проект построен на нескольких ключевых архитектурных принципах:

1.  **Модульный пайплайн (Pipeline Processing):**
    Обработка данных происходит линейно: `Чтение` → `Нормализация` → `Классификация` → `Обогащение` → `Вывод`. Это позволяет легко добавлять новые шаги (например, AI-классификацию) без переписывания всего кода.

2.  **Гибридная архитектура (Dual GUI):**
    Ядро приложения (`bom_categorizer/`) полностью отделено от интерфейса. Это позволяет поддерживать две версии GUI (Standard на Tkinter и Modern на PySide6) и CLI-режим, используя одну и ту же бизнес-логику.

3.  **Двухуровневая база знаний:**
    *   **Static:** Шаблон базы данных поставляется с приложением (Read-only при установке).
    *   **Dynamic:** Пользовательская база накапливается в профиле пользователя (`%APPDATA%`).
    Это обеспечивает безопасность данных (локальное хранение) и возможность обновлять приложение без потери накопленного опыта.

4.  **Эвристика + Правила:**
    Классификация не полагается на один метод. Используется каскад:
    *   *Точное совпадение* (База данных)
    *   *Regex паттерны* (Технические характеристики)
    *   *Пользовательские правила* (Rules.json)

---

## 🛠 Технологический стек

| Область | Технологии | Назначение |
|---------|------------|------------|
| **Core** | **Python 3.13+** | Основной язык разработки. |
| **Data** | **Pandas** | Обработка табличных данных (DataFrame), фильтрация, сортировка. |
| **GUI (Modern)** | **PySide6 (Qt)** | Современный интерфейс, стили, анимации, потоки (QThread). |
| **GUI (Standard)** | **Tkinter** | Легковесный интерфейс, встроенный в Python (для слабых ПК). |
| **IO** | **OpenPyXL, python-docx** | Чтение/запись Excel и Word файлов. |
| **Build** | **Inno Setup, py2app** | Сборка инсталляторов для Windows и macOS. |
| **QA** | **pytest** | Модульное и интеграционное тестирование. |

---

## 🔑 Ключевые модули системы

Здесь описаны самые важные файлы, формирующие ядро системы:

*   **`main.py` (Оркестратор):**
    Главный контроллер. Запускает процесс обработки, вызывает парсеры, передает данные классификаторам и инициирует запись результатов.

*   **`classifiers.py` (Мозг):**
    Содержит всю логику определения типа компонента. Здесь живут регулярные выражения для резисторов (`R\d+`), конденсаторов (`C\d+`) и микросхем.

*   **`component_database.py` (Память):**
    Отвечает за "долговременную память" приложения. Умеет загружать JSON базу, искать в ней компоненты и сохранять новые знания.

*   **`formatters.py` (Инструменты):**
    Набор функций для очистки "грязных" данных из BOM. Умеет вытаскивать номиналы (10k, 0.1uF), допуски (±5%) и ТУ-коды.

*   **`gui_qt.py` (Лицо):**
    Реализация современного интерфейса. Обрабатывает нажатия кнопок, перетаскивание файлов и обновляет прогресс-бары.

---

## 📂 Структура файлов проекта

```
ProjectSnabjenie/
├── 📦 bom_categorizer/              # Основной пакет (бизнес-логика)
│   ├── __init__.py
│   ├── main.py                      # 🧠 Оркестратор пайплайна
│   ├── classifiers.py               # 🔍 Логика классификации (Regex, эвристики)
│   ├── parsers.py                   # 📥 Чтение файлов (.docx, .xlsx, .txt)
│   ├── formatters.py                # 🧹 Очистка данных, извлечение ТУ/номиналов
│   ├── component_database.py        # 💾 Управление базой знаний (JSON)
│   ├── excel_writer.py              # 📊 Генерация Excel отчетов
│   ├── txt_writer.py                # 📝 Генерация текстовых отчетов
│   ├── utils.py                     # 🛠 Вспомогательные утилиты
│   │
│   ├── gui_qt.py                    # ✨ Modern Edition GUI (PySide6)
│   ├── dialogs_qt.py                # ✨ Диалоговые окна (статистика, настройки)
│   ├── gui_sections_qt.py           # ✨ Виджеты и секции интерфейса
│   ├── gui_menu_qt.py               # ✨ Главное меню
│   ├── gui_scaling_qt.py            # ✨ Масштабирование и темы
│   ├── search_qt.py                 # ✨ Глобальный поиск
│   ├── workers_qt.py                # ✨ Фоновые потоки (QThread)
│   ├── drag_drop_qt.py              # ✨ Drag & Drop
│   ├── pdf_exporter.py              # ✨ Экспорт в PDF
│   ├── ai_classifier_qt.py          # ✨ AI классификация
│   └── gui.py                       # ✅ Standard Edition GUI (Tkinter)
│
├── 🚀 Точки входа:
│   ├── app_qt.py                    # ▶️ Запуск Modern Edition
│   ├── app.py                       # ▶️ Запуск Standard Edition
│   ├── split_bom.py                 # 💻 CLI интерфейс
│   ├── build_installer.py           # 🔨 Сборка инсталлятора (Windows)
│   ├── build_macos.sh               # 🍎 Сборка приложения (macOS)
│   ├── manage_database.py           # 🗄️ Утилита управления БД
│   └── interactive_classify.py      # 🎓 Консольное обучение
│
├── ⚙️ Конфигурация:
│   ├── config_qt.json               # Настройки Modern Edition
│   ├── config.json                  # Настройки Standard Edition
│   ├── rules.json                   # Пользовательские правила
│   ├── component_database.json      # Локальная БД (dev)
│   ├── component_database_template.json # Шаблон БД (prod)
│   └── requirements.txt             # Зависимости
│
├── 📝 Документация:
│   ├── ANALYSIS_PROJECT.md          # 🏗 Архитектура проекта
│   ├── README.md                    # 📖 Главная страница
│   ├── CHANGELOG.md                 # 🕒 История изменений
│   ├── LAUNCHER_GUIDE.md            # 🚀 Инструкция по запуску
│   ├── TESTING_README.md            # 🧪 Тестирование
│   ├── CREATE_GIT_RELEASE.md        # 📦 Создание релизов
│   ├── BUILD.md                     # 🛠 Сборка инсталляторов
│   └── SETUP.md                     # ⚙️ Настройка окружения
│
├── 🧪 Тесты (tests/):
│   ├── test_classifiers.py          # Тесты классификации
│   ├── test_formatters.py           # Тесты форматирования
│   ├── test_database.py             # Тесты БД
│   ├── test_integration.py          # Интеграционные тесты
│   └── conftest.py                  # Фикстуры pytest
│
└── 🛠 Скрипты (Windows):
    ├── run_modern_debug.bat         # 🐞 Debug запуск Modern
    ├── run_standard_debug.bat       # 🐞 Debug запуск Standard
    ├── run_tests.bat                # 🧪 Запуск тестов
    └── create_release.ps1           # 📦 Создание релиза
```

---

**Разработчик:** Куреин М.Н.
