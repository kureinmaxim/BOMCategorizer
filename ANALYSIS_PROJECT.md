# 🏗 Архитектура проекта BOM Categorizer

**BOM Categorizer** — это десктопное приложение для автоматической классификации электронных компонентов из спецификаций (BOM).

> **Версии:** Standard v3.3.0 (Tkinter) / Modern Edition v4.4.5 (PySide6)  
> **Язык:** Python 3.13+  
> **Архитектура:** Модульный пайплайн (Pipeline)

---

## 💡 Основные идеи и принципы

Проект построен на нескольких ключевых архитектурных принципах:

1.  **Модульный пайплайн (Pipeline Processing):**
    Обработка данных происходит линейно: `Чтение` → `Нормализация` → `Классификация` → `Обогащение` → `Вывод`. Это позволяет легко добавлять новые шаги (например, AI-классификацию) без переписывания всего кода.

2.  **Гибридная архитектура (Dual GUI):**
    Ядро приложения (`bom_categorizer/`) полностью отделено от интерфейса. Это позволяет поддерживать две версии GUI (Standard на Tkinter и Modern на PySide6) и CLI-режим, используя одну и ту же бизнес-логику.

3.  **Двухуровневая база знаний:**
    *   **Static:** Шаблон базы данных поставляется с приложением (Read-only при установке).
    *   **Dynamic:** Пользовательская база накапливается в профиле пользователя (`%APPDATA%`).
    Это обеспечивает безопасность данных (локальное хранение) и возможность обновлять приложение без потери накопленного опыта.

4.  **Эвристика + Правила:**
    Классификация не полагается на один метод. Используется каскад:
    *   *Точное совпадение* (База данных)
    *   *Regex паттерны* (Технические характеристики)
    *   *Пользовательские правила* (Rules.json)

---

## 🛠 Технологический стек

| Область | Технологии | Назначение |
|---------|------------|------------|
| **Core** | **Python 3.13+** | Основной язык разработки. |
| **Data** | **Pandas** | Обработка табличных данных (DataFrame), фильтрация, сортировка. |
| **GUI (Modern)** | **PySide6 (Qt)** | Современный интерфейс, стили, анимации, потоки (QThread). |
| **GUI (Standard)** | **Tkinter** | Легковесный интерфейс, встроенный в Python (для слабых ПК). |
| **IO** | **OpenPyXL, python-docx** | Чтение/запись Excel и Word файлов. |
| **Build** | **Inno Setup, py2app** | Сборка инсталляторов для Windows и macOS. |
| **QA** | **pytest** | Модульное и интеграционное тестирование. |

---

## 🔑 Ключевые модули системы

Здесь описаны самые важные файлы, формирующие ядро системы:

*   **`main.py` (Оркестратор):**
    Главный контроллер. Запускает процесс обработки, вызывает парсеры, передает данные классификаторам и инициирует запись результатов.

*   **`classifiers.py` (Мозг):**
    Содержит всю логику определения типа компонента. Здесь живут регулярные выражения для резисторов (`R\d+`), конденсаторов (`C\d+`) и микросхем.

*   **`component_database.py` (Память):**
    Отвечает за "долговременную память" приложения. Умеет загружать JSON базу, искать в ней компоненты и сохранять новые знания.

*   **`formatters.py` (Инструменты):**
    Набор функций для очистки "грязных" данных из BOM. Умеет вытаскивать номиналы (10k, 0.1uF), допуски (±5%) и ТУ-коды.

*   **`bom_categorizer/gui/` (Пакет GUI):**
    Модульная реализация современного интерфейса Modern Edition (PySide6). Разделен на отдельные компоненты для лучшей поддерживаемости:
    - `main_window.py` — Главное окно приложения
    - `dialogs.py` — Диалоговые окна (статистика, настройки)
    - `sections.py` — Виджеты и секции интерфейса
    - `menu.py` — Главное меню
    - `scaling.py` — Масштабирование и темы
    - `search.py` — Глобальный поиск
    - `workers.py` — Фоновые потоки (QThread)
    - `drag_drop.py` — Drag & Drop
    - `ai_classifier.py` — AI классификация

---

## 📂 Структура файлов проекта

```
BOMCategorizer/
├── 📦 bom_categorizer/              # Основной пакет (бизнес-логика)
│   ├── __init__.py
│   ├── main.py                      # 🧠 Оркестратор пайплайна
│   ├── classifiers.py               # 🔍 Логика классификации (Regex, эвристики)
│   ├── parsers.py                   # 📥 Чтение файлов (.docx, .xlsx, .txt)
│   ├── formatters.py                # 🧹 Очистка данных, извлечение ТУ/номиналов
│   ├── component_database.py        # 💾 Управление базой знаний (JSON)
│   ├── config_manager.py            # ⚙️ Управление конфигурацией
│   ├── excel_writer.py              # 📊 Генерация Excel отчетов
│   ├── txt_writer.py                # 📝 Генерация текстовых отчетов
│   ├── pdf_exporter.py              # 📄 Экспорт в PDF
│   ├── utils.py                     # 🛠 Вспомогательные утилиты
│   ├── cli_interactive.py           # 💬 Интерактивная консоль
│   ├── styles.py                    # 🎨 Стили для GUI
│   │
│   ├── 📁 gui/                      # ✨ Modern Edition GUI (PySide6)
│   │   ├── __init__.py
│   │   ├── main_window.py           # Главное окно приложения
│   │   ├── dialogs.py               # Диалоговые окна
│   │   ├── sections.py              # Виджеты и секции
│   │   ├── menu.py                  # Главное меню
│   │   ├── scaling.py               # Масштабирование и темы
│   │   ├── search.py                # Глобальный поиск
│   │   ├── search_methods.py        # Методы поиска
│   │   ├── workers.py               # Фоновые потоки (QThread)
│   │   ├── drag_drop.py             # Drag & Drop
│   │   └── ai_classifier.py         # AI классификация
│   │
│   └── gui.py                       # ✅ Standard Edition GUI (Tkinter)
│
├── 🚀 Точки входа:
│   ├── app_qt.py                    # ▶️ Запуск Modern Edition
│   └── app.py                       # ▶️ Запуск Standard Edition
│
├── 📁 tools/                        # 🛠 Утилиты и инструменты
│   ├── split_bom.py                 # 💻 CLI интерфейс
│   ├── manage_database.py           # 🗄️ Утилита управления БД
│   ├── interactive_classify.py      # 🎓 Консольное обучение
│   ├── interactive_classify_improved.py # 🎓 Улучшенное обучение
│   ├── update_version.py            # 🔄 Синхронизация версий
│   ├── sync_installer_versions.py   # 🔄 Синхронизация версий инсталляторов
│   ├── create_icons.py              # 🎨 Создание иконок
│   ├── check_pdf_fonts.py           # 🔤 Проверка шрифтов PDF
│   ├── init_project.py              # 🚀 Инициализация проекта
│   └── merge_component_database.py  # 🔀 Слияние баз данных
│
├── 📁 deployment/                   # 📦 Скрипты сборки и развертывания
│   ├── build_installer.py           # 🔨 Сборка инсталлятора (Windows)
│   ├── build_macos.sh               # 🍎 Сборка приложения (macOS)
│   ├── setup_macos.py               # 🍎 Конфигурация сборки macOS
│   ├── installer_clean.iss          # 📄 Конфиг Inno Setup (Standard)
│   ├── installer_qt.iss             # 📄 Конфиг Inno Setup (Modern)
│   ├── create_release.ps1           # � Создание релиза (Windows)
│   ├── create_release.sh            # 📦 Создание релиза (macOS/Linux)
│   ├── upload_to_existing_release.ps1  # ⬆️ Публикация релиза (Windows)
│   └── upload_to_existing_release.sh   # ⬆️ Публикация релиза (macOS/Linux)
│
├── 📁 scripts/                      # 🖥 Скрипты запуска и обслуживания
│   ├── run_app.bat                  # ▶️ Запуск приложения (Windows)
│   ├── run_modern_debug.bat         # 🐞 Debug запуск Modern
│   ├── run_standard_debug.bat       # 🐞 Debug запуск Standard
│   ├── run_tests.bat                # 🧪 Запуск тестов
│   ├── post_install.ps1             # 🔧 Пост-установка (Windows)
│   ├── repair_install.ps1           # 🔧 Восстановление установки
│   ├── database_backup.bat          # 💾 Резервное копирование БД
│   ├── database_export.bat          # 📤 Экспорт БД
│   ├── database_stats.bat           # 📊 Статистика БД
│   └── manage_database.bat          # 🗄️ Управление БД
│
├── 📁 config/                       # ⚙️ Конфигурационные файлы
│   ├── config.json.template         # Шаблон настроек Standard Edition
│   ├── config_qt.json.template      # Шаблон настроек Modern Edition
│   └── rules.json                   # Пользовательские правила классификации
│
├── 📁 data/                         # 💾 Данные приложения
│   └── component_database_template.json # Шаблон базы данных компонентов
│
├── 📝 Документация:
│   ├── ANALYSIS_PROJECT.md          # 🏗 Архитектура проекта (этот файл)
│   ├── README.md                    # 📖 Главная страница
│   ├── CHANGELOG.md                 # 🕒 История изменений
│   ├── LAUNCHER_GUIDE.md            # 🚀 Инструкция по запуску
│   ├── TESTING_README.md            # 🧪 Тестирование
│   ├── CREATE_GIT_RELEASE.md        # 📦 Создание релизов
│   ├── BUILD.md                     # 🛠 Сборка инсталляторов
│   └── SETUP.md                     # ⚙️ Настройка окружения
│
├── 🧪 Тесты (tests/):
│   ├── test_classifiers.py          # Тесты классификации
│   ├── test_formatters.py           # Тесты форматирования
│   ├── test_database.py             # Тесты БД
│   ├── test_integration.py          # Интеграционные тесты
│   └── conftest.py                  # Фикстуры pytest
│
└── � Конфигурация проекта:
    ├── requirements.txt              # Основные зависимости
    ├── requirements_install.txt      # Зависимости для установки
    ├── requirements_macos.txt        # Зависимости для macOS
    └── .gitignore                    # Исключения Git
```

---

**Разработчик:** Куреин М.Н.
