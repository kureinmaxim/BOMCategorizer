# 🗄️ Руководство по управлению базой данных

> **Обновлено:** 6 ноября 2025  
> **Версия:** 3.1.2+

---

## 📋 Содержание

1. [Проблема и решение](#-проблема-и-решение)
2. [Кнопки управления БД](#-кнопки-управления-базой-данных)
3. [Синхронизация между проектом и установкой](#-синхронизация-между-проектом-и-установкой)
4. [Быстрые сценарии](#-быстрые-сценарии)
5. [FAQ](#-часто-задаваемые-вопросы)

---

## ⚠️ Проблема и решение

### Проблема
При работе с приложением база данных хранится в разных местах:
- **Проект (разработка)**: `C:\Project\ProjectSnabjenie\component_database.json`
- **Установленная версия**: `C:\Users\USERNAME\AppData\Roaming\BOMCategorizer\Data\component_database.json`

**Результат:** Компоненты, добавленные в проекте, не доступны в установке и наоборот!

### Решение
Используйте кнопку **"🔄 Заменить базу данных"** для синхронизации баз между проектом и установкой.

---

## 🔘 Кнопки управления базой данных

В главном окне приложения находится секция **"🗄️ Управление базой данных"** с 7 кнопками:

### Расположение кнопок

```
┌─────────────────────────────────────────────────────────────┐
│              🗄️ Управление базой данных                     │
├─────────────────────────────────────────────────────────────┤
│  Ряд 1: [📊 Статистика] [📤 Экспорт в Excel] [💾 Резервная копия]  │
│  Ряд 2: [📥 Импорт из Excel] [📁 Открыть папку] [🔄 Заменить БД]   │
│  Ряд 3: [⬇️ Добавить все из выходного файла]                        │
└─────────────────────────────────────────────────────────────┘
```

### Описание кнопок

#### 📊 Статистика
Показывает подробную информацию о базе данных:
- Путь к файлу базы данных
- Версию, дату создания и обновления
- Общее количество компонентов
- Распределение по категориям (резисторы, конденсаторы и т.д.)

#### 📤 Экспорт в Excel
Сохраняет базу данных в файл Excel для:
- Редактирования компонентов в Excel
- Переноса на другой ПК
- Создания резервной копии в удобном формате

#### 💾 Резервная копия
Создает резервную копию базы данных в формате JSON с временной меткой:
```
C:\Users\USERNAME\AppData\Roaming\BOMCategorizer\Data\database_backups\
  component_database_backup_20251106_143022.json
```

#### 📥 Импорт из Excel
Импортирует компоненты из Excel файла:
- **Объединить** - добавить новые компоненты к существующим
- **Заменить** - полностью заменить базу данных
- ✅ Автоматическое резервное копирование перед импортом

#### 📁 Открыть папку
Открывает папку с базой данных в проводнике Windows.

#### 🔄 Заменить базу данных (НОВОЕ!)
**Основная функция для синхронизации!**

Заменяет текущую базу данных файлом из другого источника:
- ✅ Синхронизация между проектом и установкой
- ✅ Импорт базы из другого проекта
- ✅ Восстановление из резервной копии
- ✅ Автоматическое резервное копирование перед заменой
- ✅ Проверка формата и количества компонентов

#### ⬇️ Добавить все из выходного файла
Автоматически добавляет все компоненты из обработанного выходного файла в базу данных:
1. Обработайте входные файлы
2. Проверьте выходной .xlsx файл
3. Нажмите кнопку - все компоненты добавятся в базу!

---

## 🔄 Синхронизация между проектом и установкой

### Пошаговая инструкция

#### Вариант 1: Проект → Установка

```
┌─────────────────────────────────────────────────────────────┐
│  ШАГ 1: Работа в проекте                                    │
└─────────────────────────────────────────────────────────────┘
1. Запустить приложение из проекта (start_gui.bat)
2. Обработать файлы и проверить результат
3. Нажать "⬇️ Добавить все из выходного файла"
   ✅ База в ПРОЕКТЕ обновлена (например, 83 компонента)

┌─────────────────────────────────────────────────────────────┐
│  ШАГ 2: Синхронизация с установкой                          │
└─────────────────────────────────────────────────────────────┘
4. Запустить УСТАНОВЛЕННУЮ версию (Пуск → BOM Categorizer)
5. Нажать "🔄 Заменить базу данных"
6. Выбрать файл: C:\Project\ProjectSnabjenie\component_database.json
7. Подтвердить замену в диалоге
   ✅ База в УСТАНОВКЕ синхронизирована (83 компонента)
   💾 Резервная копия старой базы создана автоматически
```

#### Вариант 2: Установка → Проект

```
1. В установленной версии: "📁 Открыть папку"
2. Скопировать component_database.json
3. В проекте: "🔄 Заменить базу данных"
4. Выбрать скопированный файл
   ✅ Синхронизировано!
```

### Диалог подтверждения замены

При нажатии "🔄 Заменить базу данных" появится диалог:

```
╔═══════════════════════════════════════════════════════════╗
║              🔄 ЗАМЕНА БАЗЫ ДАННЫХ                        ║
╠═══════════════════════════════════════════════════════════╣
║ Текущая база данных:                                      ║
║   📊 Компонентов: 50                                      ║
║   📁 Расположение: ...\AppData\...\component_database.json║
║                                                            ║
║ Новая база данных:                                        ║
║   📊 Компонентов: 83                                      ║
║   📁 Файл: component_database.json                        ║
║                                                            ║
║ ⚠️ Текущая база будет заменена!                           ║
║ Резервная копия будет создана автоматически.              ║
║                                                            ║
║         [ Да ]              [ Нет ]                        ║
╚═══════════════════════════════════════════════════════════╝
```

---

## 🚀 Быстрые сценарии

### Сценарий 1: Просмотр информации о базе
```
1. Нажать "📊 Статистика"
2. Посмотреть количество компонентов и распределение
3. Закрыть окно
```

### Сценарий 2: Перенос базы на другой ПК
```
ПК-1:
1. Нажать "📤 Экспорт в Excel"
2. Сохранить файл на USB-диск

ПК-2:
1. Установить программу
2. Нажать "📥 Импорт из Excel"
3. Выбрать файл с USB-диска
4. Выбрать "Объединить" или "Заменить"
   ✅ База импортирована!
```

### Сценарий 3: Регулярное резервное копирование
```
1. Раз в неделю: нажать "💾 Резервная копия"
2. (Опционально) "📁 Открыть папку" → скопировать в облако
```

### Сценарий 4: Редактирование компонентов
```
1. "📤 Экспорт в Excel"
2. Открыть файл в Excel
3. Отредактировать названия/категории
4. Сохранить файл
5. "📥 Импорт из Excel" → "Заменить"
   ✅ Изменения применены!
```

### Сценарий 5: Восстановление из резервной копии
```
1. "📁 Открыть папку"
2. Перейти в папку "database_backups"
3. Найти нужную резервную копию по дате
4. "🔄 Заменить базу данных"
5. Выбрать файл резервной копии
   ✅ База восстановлена!
```

### Сценарий 6: Импорт базы из другого проекта
```
1. Получить component_database.json из другого проекта
2. "🔄 Заменить базу данных"
3. Выбрать полученный файл
4. Подтвердить замену
   ✅ 150 компонентов импортировано!
```

---

## 📁 Расположение файлов

### Пути к базе данных

| Режим | Путь |
|-------|------|
| **Проект** | `C:\Project\ProjectSnabjenie\component_database.json` |
| **Установка** | `%APPDATA%\BOMCategorizer\Data\component_database.json` |
| **Резервные копии** | `%APPDATA%\BOMCategorizer\Data\database_backups\` |

### Быстрый доступ к папкам

- **Win + R** → `%APPDATA%\BOMCategorizer\Data` → **Enter**
- Клик на **"📁 Установка"** в футере приложения
- Кнопка **"📁 Открыть папку"**

---

## 🛡️ Безопасность

### Автоматические резервные копии

Резервные копии создаются автоматически:
- ✅ Перед импортом из Excel
- ✅ Перед заменой базы данных

Резервные копии **НЕ удаляются** автоматически - можете очистить вручную если нужно.

### Защита от потери данных

| Операция | Резервная копия | Подтверждение |
|----------|----------------|---------------|
| Экспорт в Excel | ❌ Не требуется | ❌ Не требуется |
| Резервная копия | ✅ Создает копию | ❌ Не требуется |
| Импорт из Excel | ✅ Автоматически | ✅ Выбор режима |
| Заменить БД | ✅ Автоматически | ✅ Диалог подтверждения |
| Добавить из файла | ❌ Не создается | ❌ Не требуется |

---

## ❓ Часто задаваемые вопросы

### Q: Что произойдет с текущей базой при замене?
**A:** Создается автоматическая резервная копия, затем текущая база полностью заменяется новой.

### Q: Можно ли отменить замену базы?
**A:** Да! Используйте резервную копию из папки `database_backups`.

### Q: Как объединить две базы данных?
**A:** 
1. Экспортируйте обе базы в Excel
2. Объедините их вручную в Excel
3. Импортируйте объединенную базу в режиме "Заменить"

### Q: Нужно ли перезапускать приложение после операций с БД?
**A:** Рекомендуется для обновления информации в футере (количество компонентов).

### Q: База данных удалится при деинсталляции?
**A:** **НЕТ!** База хранится в отдельной папке `Data` и НЕ удаляется при деинсталляции.

### Q: Как понять, какая база используется - проекта или установки?
**A:** Посмотрите в футер приложения:
- **"📁 Установка (%APPDATA%)"** - используется база установки
- **"📁 Проект (разработка)"** - используется база проекта

### Q: Что делать если база повредилась?
**A:** Восстановите из резервной копии или создайте новую базу заново.

### Q: Можно ли редактировать базу данных JSON вручную?
**A:** Можно, но **не рекомендуется**. Используйте экспорт в Excel → редактирование → импорт.

### Q: Как посмотреть полный путь к базе данных?
**A:** Нажмите **"📊 Статистика"** - в первой строке будет показан полный путь.

---

## 💡 Рекомендации

### Лучшие практики

✅ **Регулярное резервное копирование**
- Создавайте резервные копии перед важными операциями
- Раз в неделю делайте ручной бэкап

✅ **Проверка перед заменой**
- Всегда смотрите на количество компонентов в диалоге
- Убедитесь что заменяете правильный файл

✅ **Синхронизация после работы**
- Поработали в проекте → синхронизируйте с установкой
- Это гарантирует актуальность базы везде

✅ **Использование Excel для редактирования**
- Не редактируйте JSON вручную
- Экспорт → Excel → Импорт безопаснее

✅ **Проверка статистики**
- Периодически проверяйте количество компонентов
- Это поможет заметить проблемы

---

## 🔧 Технические детали

### Форматы файлов

Поддерживаются оба формата JSON:

**Новый формат (с метаданными):**
```json
{
  "metadata": {
    "version": "1.0.0",
    "created": "2025-11-01",
    "last_updated": "2025-11-06",
    "total_components": 83
  },
  "categories": { ... },
  "components": {
    "1594ТЛ2Т": "ics",
    "HMC435AMS8GE": "ics"
  }
}
```

**Старый формат (прямой словарь):**
```json
{
  "1594ТЛ2Т": "ics",
  "HMC435AMS8GE": "ics"
}
```

### Определение режима работы

Приложение автоматически определяет режим:
- **Есть файл `.installed`** → Установленная версия → База в `%APPDATA%`
- **Нет файла `.installed`** → Режим разработки → База в папке проекта

---

## 📞 Поддержка

Если возникли проблемы:

1. ✅ Проверьте наличие резервных копий
2. ✅ Посмотрите лог в текстовом поле приложения
3. ✅ Нажмите "📊 Статистика" для диагностики
4. ✅ Проверьте формат JSON файла (если редактировали вручную)
5. ✅ Обратитесь к разработчику

### Связанная документация

- 📘 [DATABASE_GUIDE.md](DATABASE_GUIDE.md) - Подробное руководство по БД
- 📘 [DATA_STORAGE.md](DATA_STORAGE.md) - Хранение данных
- 📘 [DATABASE_REPLACE_GUIDE.md](DATABASE_REPLACE_GUIDE.md) - Детальное описание замены БД

---

**Версия документа:** 1.0  
**Дата:** 6 ноября 2025  
**Автор:** Указан в config.json → app_info → developer

