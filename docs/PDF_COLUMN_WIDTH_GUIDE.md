# Руководство по настройке ширины колонок в PDF

## Где задается ширина колонок

**Файл:** `bom_categorizer/pdf_exporter.py`  
**Функция:** `_create_table()` (начинается со строки 486)  
**Секция:** Определение ширины колонок (строки 527-566)

---

## Как это работает

### 1. Доступная ширина страницы

```python
page_width = self.page_size[0] - 20*mm  # Вычитаем отступы
```

**Расшифровка:**
- `self.page_size[0]` — ширина страницы (для альбомной A4 = **297mm**)
- `-20*mm` — левый и правый отступы (по 10mm с каждой стороны)
- **Итого доступно:** 297 - 20 = **277mm**

---

### 2. Распределение для 8 колонок (основной случай)

**Код:** `bom_categorizer/pdf_exporter.py` (строки 533-544)

```python
if num_cols == 8:
    # Оптимальное распределение ширины для 8 колонок
    col_widths = [
        10*mm,   # 1. № п/п (минимальная)
        74*mm,   # 2. Наименование ИВП (широкая, увеличена на 2mm)
        44*mm,   # 3. ТУ (увеличена на 2mm)
        58*mm,   # 4. Источник (увеличена на 1mm)
        10*mm,   # 5. шт. (минимальная)
        50*mm,   # 6. Примечание (увеличена на 2mm)
        15*mm,   # 7. № ТРУ (минимальная)
        22*mm    # 8. Стоимость (узкая)
    ]
```

**Итоговая таблица:**

| № | Колонка           | Ширина | Назначение                      | Выравнивание |
|---|-------------------|--------|---------------------------------|--------------|
| 1 | № п/п             | 10mm   | Номер позиции (узкая)          | CENTER       |
| 2 | Наименование ИВП  | 74mm   | Основное содержимое (широкая)  | LEFT         |
| 3 | ТУ                | 44mm   | Технические условия            | LEFT         |
| 4 | Источник          | 58mm   | Файл и номер п/п               | LEFT         |
| 5 | шт.               | 10mm   | Количество (узкая)             | CENTER       |
| 6 | Примечание        | 50mm   | Дополнительная информация      | LEFT         |
| 7 | № ТРУ             | 15mm   | Номер ТРУ (узкая)              | CENTER       |
| 8 | Стоимость         | 22mm   | Стоимость (средняя)            | RIGHT        |
| **ИТОГО** | | **283mm** | (превышает доступные 277mm на 6mm) | |

> ⚠️ **Примечание:** Небольшое превышение (6mm) компенсируется автоматическим сжатием ReportLab.

---

### 3. Распределение для 7 колонок (если нет одной колонки)

**Код:** `bom_categorizer/pdf_exporter.py` (строки 545-555)

```python
elif num_cols == 7:
    # Если 7 колонок (без стоимости или другого поля)
    col_widths = [
        15*mm,   # № п/п
        75*mm,   # Наименование ИВП
        60*mm,   # ТУ
        52*mm,   # Источник (увеличена за счет № ТРУ)
        20*mm,   # шт.
        50*mm,   # Примечание
        15*mm    # № ТРУ (минимальная)
    ]
```

---

### 4. Автоматическое распределение (для других случаев)

**Код:** `bom_categorizer/pdf_exporter.py` (строки 556-566)

```python
else:
    # Для других количеств колонок - равномерное распределение
    col_width = page_width / num_cols if num_cols > 0 else 50*mm
    
    # Ограничиваем ширину колонок
    if col_width > 60*mm:
        col_width = 60*mm
    elif col_width < 15*mm:
        col_width = 15*mm
    
    col_widths = [col_width] * num_cols
```

**Логика:**
1. Делим доступную ширину поровну: `page_width / num_cols`
2. Ограничиваем максимум: **60mm**
3. Ограничиваем минимум: **15mm**
4. Применяем ко всем колонкам

---

## Как настроить выравнивание

**Файл:** `bom_categorizer/pdf_exporter.py`  
**Секция:** Стили таблицы (строки 643-651)

### Выравнивание заголовков

**Код:** (строка 621)
```python
style.add('ALIGN', (0, header_row), (-1, header_row), 'CENTER')
```

**Расшифровка:**
- `(0, header_row)` — начало диапазона (колонка 0, строка заголовка)
- `(-1, header_row)` — конец диапазона (последняя колонка -1, строка заголовка)
- `'CENTER'` — все заголовки по центру

---

### Выравнивание значений

**Код:** (строки 643-651)
```python
# Колонка № п/п (0) - центр (для всех случаев)
style.add('ALIGN', (0, body_start_row), (0, -1), 'CENTER')

# Колонка шт. (обычно 4) - центр
if num_cols > 4:
    style.add('ALIGN', (4, body_start_row), (4, -1), 'CENTER')

# Колонка Стоимость (обычно последняя) - право
if num_cols == 8:
    style.add('ALIGN', (7, body_start_row), (7, -1), 'RIGHT')
```

**Расшифровка:**
- `(0, body_start_row)` — начало: колонка 0, первая строка данных
- `(0, -1)` — конец: колонка 0, последняя строка (-1)
- `'CENTER'` / `'LEFT'` / `'RIGHT'` — выравнивание

**Доступные значения выравнивания:**
- `'LEFT'` — по левому краю (по умолчанию для текста)
- `'CENTER'` — по центру (для номеров и количеств)
- `'RIGHT'` — по правому краю (для денежных значений)

---

## Примеры настройки

### Пример 1: Изменить ширину колонки "Наименование ИВП"

**Было:** 74mm  
**Хотим:** 80mm

```python
col_widths = [
    10*mm,   # 1. № п/п
    80*mm,   # 2. Наименование ИВП ← ИЗМЕНЕНО с 74mm на 80mm
    44*mm,   # 3. ТУ
    # ... остальные колонки
]
```

⚠️ **Важно:** Нужно компенсировать, уменьшив другие колонки на 6mm.

---

### Пример 2: Сделать колонку "шт." еще уже

**Было:** 10mm  
**Хотим:** 8mm

```python
col_widths = [
    10*mm,   # 1. № п/п
    74*mm,   # 2. Наименование ИВП
    44*mm,   # 3. ТУ
    58*mm,   # 4. Источник
    8*mm,    # 5. шт. ← ИЗМЕНЕНО с 10mm на 8mm
    52*mm,   # 6. Примечание ← УВЕЛИЧЕНО на 2mm
    # ... остальные
]
```

---

### Пример 3: Добавить выравнивание по центру для новой колонки

Предположим, добавили колонку "№ ТРУ" в позицию 6 (индекс 6):

```python
# Колонка № ТРУ (6) - центр
if num_cols > 6:
    style.add('ALIGN', (6, body_start_row), (6, -1), 'CENTER')
```

---

## Порядок индексов колонок

| Индекс | Колонка           | Описание                |
|--------|-------------------|-------------------------|
| 0      | № п/п             | Номер позиции          |
| 1      | Наименование ИВП  | Основное содержимое    |
| 2      | ТУ                | Технические условия    |
| 3      | Источник          | Файл и номер п/п       |
| 4      | шт.               | Количество             |
| 5      | Примечание        | Дополнительная информация |
| 6      | № ТРУ             | Номер ТРУ              |
| 7      | Стоимость         | Стоимость              |

**Нумерация начинается с 0!**

---

## Единицы измерения

**ReportLab использует:**
- `mm` — миллиметры (1mm = 2.834645669291339 points)
- `cm` — сантиметры
- `inch` — дюймы
- `pt` — points (базовая единица)

**Импорт:**
```python
from reportlab.lib.units import mm, cm, inch
```

**Примеры:**
```python
10*mm   # 10 миллиметров
2.5*cm  # 2.5 сантиметра
1*inch  # 1 дюйм (25.4mm)
12      # 12 points (без умножения)
```

---

## Размеры страниц

**Альбомная ориентация** (текущая настройка):
```python
from reportlab.lib.pagesizes import A4, landscape

self.page_size = landscape(A4)
# Ширина: 297mm (A4 альбомная)
# Высота: 210mm
```

**Портретная ориентация** (если нужна):
```python
self.page_size = A4
# Ширина: 210mm (A4 книжная)
# Высота: 297mm
```

---

## Рекомендации по настройке ширины

### 1. Общая ширина

Старайтесь, чтобы сумма ширин колонок **≈ 270-280mm**:
- Меньше 270mm → таблица выглядит сжатой
- Больше 285mm → может выходить за границы

### 2. Минимальные ширины

Рекомендуемые минимумы:
- Номера (№ п/п, № ТРУ): **8-10mm**
- Количество (шт.): **8-12mm**
- Короткие текстовые: **20-30mm**
- Средние текстовые: **40-50mm**
- Длинные текстовые: **60-80mm**

### 3. Приоритеты

Самые важные колонки (давать больше места):
1. **Наименование ИВП** — основное содержимое (60-80mm)
2. **ТУ** — технические условия (40-50mm)
3. **Источник** — важно для отслеживания (50-60mm)
4. **Примечание** — дополнительная информация (45-55mm)

Компактные колонки (минимум места):
- № п/п, шт., № ТРУ — по 8-12mm
- Стоимость — 20-25mm

---

## Тестирование изменений

### 1. Локальное тестирование

```python
# В терминале
cd /path/to/project
source venv/bin/activate  # macOS/Linux
python3 -c "from bom_categorizer.pdf_exporter import export_bom_to_pdf; \
            export_bom_to_pdf('test_file.xlsx', 'test_output.pdf')"
```

### 2. Проверка ширины

Откройте PDF и проверьте:
- ✅ Все колонки видны
- ✅ Текст не обрезается
- ✅ Ширина пропорциональна важности
- ✅ Таблица не выходит за границы

---

## История изменений

### 15.11.2025 — Оптимизация ширины
- № п/п: 15mm → **10mm** (освобождено 5mm)
- шт.: 12mm → **10mm** (освобождено 2mm)
- Освободившиеся 7mm распределены на:
  - Наименование ИВП: +2mm → **74mm**
  - ТУ: +2mm → **44mm**
  - Источник: +1mm → **58mm**
  - Примечание: +2mm → **50mm**

---

## Связанные файлы

- `bom_categorizer/pdf_exporter.py` — основной код экспорта в PDF
- `bom_categorizer/excel_writer.py` — подготовка данных для экспорта
- `docs/PDF_COLUMN_WIDTH_GUIDE.md` — этот документ

---

## Полезные ссылки

- [ReportLab Documentation](https://www.reportlab.com/docs/reportlab-userguide.pdf)
- [ReportLab Table Styles](https://www.reportlab.com/docs/reportlab-userguide.pdf#chapter.7)
- [Python Units in ReportLab](https://www.reportlab.com/docs/reportlab-reference.pdf)

