# üñ•Ô∏è –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ —à—Ä–∏—Ñ—Ç–æ–≤ –¥–ª—è macOS Retina –¥–∏—Å–ø–ª–µ–µ–≤

**–î–∞—Ç–∞:** 15.11.2025  
**–í–µ—Ä—Å–∏—è:** 4.3.6+  
**–°—Ç–∞—Ç—É—Å:** ‚úÖ –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–æ

---

## üîç –ü—Ä–æ–±–ª–µ–º–∞

–ù–∞ macOS —Å Retina –¥–∏—Å–ø–ª–µ—è–º–∏ (2x DPI) —à—Ä–∏—Ñ—Ç—ã –≤ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–∏ Modern Edition –æ—Ç–æ–±—Ä–∞–∂–∞–ª–∏—Å—å **–≤ 2 —Ä–∞–∑–∞ –º–µ–Ω—å—à–µ** —á–µ–º –Ω–∞ Windows, –¥–µ–ª–∞—è –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å –Ω–µ—á–∏—Ç–∞–µ–º—ã–º.

**–°–∏–º–ø—Ç–æ–º—ã:**
- –ú–µ–ª–∫–∏–µ –º–µ—Ç–∫–∏ –ø–æ–ª–µ–π ("–í—Ö–æ–¥–Ω—ã–µ —Ñ–∞–π–ª—ã:", "–ö–æ–ª–∏—á–µ—Å—Ç–≤–æ —ç–∫–∑–µ–º–ø–ª—è—Ä–æ–≤:" –∏ —Ç.–¥.)
- –ú–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç –Ω–∞ –∫–Ω–æ–ø–∫–∞—Ö
- –ú–µ–ª–∫–∏–µ –ø–ª–µ–π—Å—Ö–æ–ª–¥–µ—Ä—ã –≤ –ø–æ–ª—è—Ö –≤–≤–æ–¥–∞
- –ú–µ–ª–∫–∏–π —Ç–µ–∫—Å—Ç –≤ —Ñ—É—Ç–µ—Ä–µ
- –ü—Ä–∏ —ç—Ç–æ–º –∑–∞–≥–æ–ª–æ–≤–∫–∏ —Å–µ–∫—Ü–∏–π –±—ã–ª–∏ –∫—Ä—É–ø–Ω—ã–º–∏ (–∏–∑-–∑–∞ –∑–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã—Ö —Ä–∞–∑–º–µ—Ä–æ–≤ –≤ CSS)

---

## ‚úÖ –†–µ—à–µ–Ω–∏–µ

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã **macOS-—Å–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è** –¥–ª—è –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ–π —Ä–∞–±–æ—Ç—ã –Ω–∞ Retina –¥–∏—Å–ø–ª–µ—è—Ö. –ù–∞ Windows –∏ Linux –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–∞–∫ —Ä–∞–Ω—å—à–µ.

### 1. High DPI Support –≤ Qt (—Å—Ç—Ä–æ–∫–∏ 4084-4105 –≤ `gui_qt.py`)

```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ main() –î–û —Å–æ–∑–¥–∞–Ω–∏—è QApplication:
import os as os_env
if platform.system() == 'Darwin':  # macOS
    # –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è
    os_env.environ['QT_AUTO_SCREEN_SCALE_FACTOR'] = '1'
    os_env.environ['QT_ENABLE_HIGHDPI_SCALING'] = '1'
    os_env.environ['QT_SCALE_FACTOR_ROUNDING_POLICY'] = 'PassThrough'

# Qt –∞—Ç—Ä–∏–±—É—Ç—ã
QApplication.setAttribute(Qt.AA_EnableHighDpiScaling, True)
QApplication.setAttribute(Qt.AA_UseHighDpiPixmaps, True)
QApplication.setHighDpiScaleFactorRoundingPolicy(
    Qt.HighDpiScaleFactorRoundingPolicy.PassThrough
)
```

### 2. –ì–ª–æ–±–∞–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç –¥–ª—è macOS (—Å—Ç—Ä–æ–∫–∏ 4116-4136 –≤ `gui_qt.py`)

```python
# –í —Ñ—É–Ω–∫—Ü–∏–∏ main() –ü–û–°–õ–ï —Å–æ–∑–¥–∞–Ω–∏—è QApplication, –Ω–æ –î–û —Å–æ–∑–¥–∞–Ω–∏—è –æ–∫–Ω–∞:
if platform.system() == 'Darwin':  # macOS
    try:
        screens = QGuiApplication.screens()
        if screens and screens[0].devicePixelRatio() >= 2:
            base_size = 18  # Retina –¥–∏—Å–ø–ª–µ–π
        else:
            base_size = 14  # –û–±—ã—á–Ω—ã–π –¥–∏—Å–ø–ª–µ–π
    except:
        base_size = 18
    
    app_font = QFont(get_system_font(), base_size)
    app.setFont(app_font)
```

### 3. –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –±–∞–∑–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä (—Å—Ç—Ä–æ–∫–∏ 158-173 –≤ `gui_qt.py`)

```python
# –í __init__ –∫–ª–∞—Å—Å–∞ BOMCategorizerMainWindow:
if platform.system() == 'Darwin':  # macOS
    try:
        screens = QGuiApplication.screens()
        if screens and screens[0].devicePixelRatio() >= 2:
            self.base_font_size = 18  # Retina
        else:
            self.base_font_size = 14  # –û–±—ã—á–Ω—ã–π
    except:
        self.base_font_size = 18
else:  # Windows –∏ Linux
    self.base_font_size = 12
```

### 4. –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π –¥–µ—Ñ–æ–ª—Ç–Ω—ã–π scale_factor (—Å—Ç—Ä–æ–∫–∏ 177-178 –≤ `gui_qt.py`)

```python
# –î–µ—Ñ–æ–ª—Ç–Ω—ã–π scale –∑–∞–≤–∏—Å–∏—Ç –æ—Ç –û–°
default_scale = 1.1 if platform.system() == 'Darwin' else 0.8
```

### 5. –£–¥–∞–ª–µ–Ω–∏–µ font-size –∏–∑ —Å—Ç–∏–ª–µ–π –Ω–∞ macOS (—Å—Ç—Ä–æ–∫–∏ 243-258 –≤ `gui_qt.py`)

```python
def apply_theme(self):
    """–ü—Ä–∏–º–µ–Ω—è–µ—Ç –≤—ã–±—Ä–∞–Ω–Ω—É—é —Ç–µ–º—É –∫ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—é"""
    if self.current_theme == "dark":
        theme_style = DARK_THEME
    else:
        theme_style = LIGHT_THEME
    
    # –ù–∞ macOS —É–¥–∞–ª—è–µ–º –≤—Å–µ font-size –∏–∑ —Å—Ç–∏–ª–µ–π
    if platform.system() == 'Darwin':  # macOS
        import re
        theme_style = re.sub(r'\s*font-size:\s*\d+pt;', '', theme_style)
    
    self.setStyleSheet(theme_style)
```

**–ü—Ä–∏—á–∏–Ω–∞:** –ó–∞—Ö–∞—Ä–¥–∫–æ–∂–µ–Ω–Ω—ã–µ `font-size` –≤ CSS –ø–µ—Ä–µ–æ–ø—Ä–µ–¥–µ–ª—è–ª–∏ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–µ —à—Ä–∏—Ñ—Ç—ã. –ù–∞ Windows/Linux –æ–Ω–∏ –Ω—É–∂–Ω—ã, –Ω–æ –Ω–∞ macOS –º–µ—à–∞—é—Ç –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—é.

---

## üìä –†–µ–∑—É–ª—å—Ç–∞—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Windows/Linux | macOS (–Ω–µ Retina) | macOS (Retina) |
|----------|---------------|-------------------|----------------|
| **base_font_size** | 12pt | 14pt | 18pt |
| **default_scale** | 0.8 | 1.1 | 1.1 |
| **–ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä** | 12 √ó 0.8 = 9.6pt | 14 √ó 1.1 = 15.4pt | 18 √ó 1.1 = 19.8pt |
| **font-size –≤ CSS** | ‚úÖ –ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è | ‚ùå –£–¥–∞–ª—è–µ—Ç—Å—è |

---

## üéØ –ü—Ä–∏–Ω—Ü–∏–ø —Ä–∞–±–æ—Ç—ã

1. **–ü—Ä–∏ –∑–∞–ø—É—Å–∫–µ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è** (`main()`):
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è Qt –¥–ª—è High DPI
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞—é—Ç—Å—è Qt –∞—Ç—Ä–∏–±—É—Ç—ã –¥–ª—è –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏—è
   - –ù–∞ macOS —É—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è –≥–ª–æ–±–∞–ª—å–Ω—ã–π —à—Ä–∏—Ñ—Ç 18pt –î–û —Å–æ–∑–¥–∞–Ω–∏—è –≤–∏–¥–∂–µ—Ç–æ–≤

2. **–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –æ–∫–Ω–∞** (`__init__`):
   - –û–ø—Ä–µ–¥–µ–ª—è–µ—Ç—Å—è —Ç–∏–ø –¥–∏—Å–ø–ª–µ—è (Retina –∏–ª–∏ –æ–±—ã—á–Ω—ã–π)
   - –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ—Ç—Å—è —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–π `base_font_size`
   - –ó–∞–≥—Ä—É–∂–∞–µ—Ç—Å—è `scale_factor` –∏–∑ –∫–æ–Ω—Ñ–∏–≥–∞ (–∏–ª–∏ –¥–µ—Ñ–æ–ª—Ç 1.1 –¥–ª—è macOS)

3. **–ü—Ä–∏ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–∏ —Ç–µ–º—ã** (`apply_theme()`):
   - –ù–∞ macOS –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —É–¥–∞–ª—è—é—Ç—Å—è –≤—Å–µ `font-size:` –∏–∑ CSS
   - –ù–∞ Windows/Linux CSS –æ—Å—Ç–∞–µ—Ç—Å—è –Ω–µ–∏–∑–º–µ–Ω–Ω—ã–º

4. **–ü—Ä–∏ –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–∏** (`apply_scale_factor()`):
   - –í—ã—á–∏—Å–ª—è–µ—Ç—Å—è: `font_size = base_font_size √ó scale_factor`
   - –ü—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è –∫–æ –≤—Å–µ–º –≤–∏–¥–∂–µ—Ç–∞–º —Ä–µ–∫—É—Ä—Å–∏–≤–Ω–æ

---

## üîß –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ —Ä–∞–∑–Ω—ã—Ö –û–°

### Windows
- –ò—Å–ø–æ–ª—å–∑—É–µ—Ç —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
- CSS —Å —Ñ–∏–∫—Å–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏ `font-size` —Ä–∞–±–æ—Ç–∞–µ—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
- –ú–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ —á–µ—Ä–µ–∑ `scale_factor` (0.8-1.5)

### Linux  
- –ê–Ω–∞–ª–æ–≥–∏—á–Ω–æ Windows
- –ú–æ–∂–µ—Ç –ø–æ—Ç—Ä–µ–±–æ–≤–∞—Ç—å—Å—è –Ω–∞—Å—Ç—Ä–æ–π–∫–∞ —à—Ä–∏—Ñ—Ç–æ–≤ –≤ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ –æ—Ç DE

### macOS (–Ω–µ Retina)
- –£–≤–µ–ª–∏—á–µ–Ω–Ω—ã–π `base_font_size`: 14pt
- `font-size` —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ CSS
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–π `scale_factor`: 1.1

### macOS (Retina 2x)
- –ú–∞–∫—Å–∏–º–∞–ª—å–Ω—ã–π `base_font_size`: 18pt
- High DPI –º–∞—Å—à—Ç–∞–±–∏—Ä–æ–≤–∞–Ω–∏–µ Qt –≤–∫–ª—é—á–µ–Ω–æ
- `font-size` —É–¥–∞–ª—è—é—Ç—Å—è –∏–∑ CSS
- –î–µ—Ñ–æ–ª—Ç–Ω—ã–π `scale_factor`: 1.1
- **–ò—Ç–æ–≥–æ–≤—ã–π —Ä–∞–∑–º–µ—Ä: 18 √ó 1.1 = 19.8pt** (—Ö–æ—Ä–æ—à–æ —á–∏—Ç–∞–µ–º–æ)

---

## üìù –§–∞–π–ª—ã –∏–∑–º–µ–Ω–µ–Ω–∏–π

| –§–∞–π–ª | –ò–∑–º–µ–Ω–µ–Ω–∏—è |
|------|-----------|
| `bom_categorizer/gui_qt.py` | –û—Å–Ω–æ–≤–Ω—ã–µ –∏—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è (200+ —Å—Ç—Ä–æ–∫) |
| `bom_categorizer/styles.py` | –ë–µ–∑ –∏–∑–º–µ–Ω–µ–Ω–∏–π (CSS –æ—Å—Ç–∞–ª—Å—è –æ—Ä–∏–≥–∏–Ω–∞–ª—å–Ω—ã–º) |

---

## ‚ú® –û—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏ —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏

1. **–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ Retina**
   ```python
   screens[0].devicePixelRatio() >= 2
   ```

2. **Fallback –Ω–∞ –±–µ–∑–æ–ø–∞—Å–Ω—ã–µ –∑–Ω–∞—á–µ–Ω–∏—è**
   - –ï—Å–ª–∏ –Ω–µ —É–¥–∞–ª–æ—Å—å –æ–ø—Ä–µ–¥–µ–ª–∏—Ç—å DPI ‚Üí –∏—Å–ø–æ–ª—å–∑—É–µ–º –±–æ–ª—å—à–∏–µ —à—Ä–∏—Ñ—Ç—ã
   - –ï—Å–ª–∏ screens –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω ‚Üí base_size = 18pt

3. **–°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å—Å–∫–∏—Ö –Ω–∞—Å—Ç—Ä–æ–µ–∫**
   - –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å –º–æ–∂–µ—Ç –∏–∑–º–µ–Ω–∏—Ç—å `scale_factor` —á–µ—Ä–µ–∑ –º–µ–Ω—é
   - –ò–∑–º–µ–Ω–µ–Ω–∏—è —Å–æ—Ö—Ä–∞–Ω—è—é—Ç—Å—è –≤ `config_qt.json`
   - –ü—Ä–∏ —Å–ª–µ–¥—É—é—â–µ–º –∑–∞–ø—É—Å–∫–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–Ω–æ–µ –∑–Ω–∞—á–µ–Ω–∏–µ

4. **–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å**
   - –ö–æ–¥ —Å–æ–≤–º–µ—Å—Ç–∏–º —Å Qt 5 –∏ Qt 6
   - Graceful degradation –¥–ª—è —Å—Ç–∞—Ä—ã—Ö –≤–µ—Ä—Å–∏–π Qt
   - –ü—Ä–æ–≤–µ—Ä–∫–∏ `hasattr()` –¥–ª—è –Ω–æ–≤—ã—Ö API

---

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

–ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–æ –Ω–∞:
- ‚úÖ macOS 15.1 (Sequoia), M-series, Retina 2x
- ‚è≥ Windows 11 (–æ–∂–∏–¥–∞–µ—Ç—Å—è)
- ‚è≥ Linux Ubuntu 22.04 (–æ–∂–∏–¥–∞–µ—Ç—Å—è)

---

## üí° –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –æ–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è

1. –ù–∞ macOS –Ω–µ–ª—å–∑—è –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å `font-size` –≤ –∫–∞—Å—Ç–æ–º–Ω—ã—Ö —Å—Ç–∏–ª—è—Ö - –æ–Ω–∏ –±—É–¥—É—Ç —É–¥–∞–ª–µ–Ω—ã
2. –†–∞–∑–º–µ—Ä—ã —à—Ä–∏—Ñ—Ç–æ–≤ —É–ø—Ä–∞–≤–ª—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –ø—Ä–æ–≥—Ä–∞–º–º–Ω–æ —á–µ—Ä–µ–∑ `base_font_size` –∏ `scale_factor`
3. –ò–∑–º–µ–Ω–µ–Ω–∏—è –ø—Ä–∏–º–µ–Ω—è—é—Ç—Å—è —Ç–æ–ª—å–∫–æ –∫ Modern Edition (PySide6), Standard Edition (Tkinter) –Ω–µ –∑–∞—Ç—Ä–æ–Ω—É—Ç

---

## üîó –°–≤—è–∑–∞–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã

- [gui_qt.py](../bom_categorizer/gui_qt.py) - –æ—Å–Ω–æ–≤–Ω–æ–π –∫–æ–¥
- [styles.py](../bom_categorizer/styles.py) - —Ç–µ–º—ã –æ—Ñ–æ—Ä–º–ª–µ–Ω–∏—è
- [config_qt.json.template](../config_qt.json.template) - –¥–µ—Ñ–æ–ª—Ç–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è

---

**–ê–≤—Ç–æ—Ä:** –ö—É—Ä–µ–∏–Ω –ú.–ù. / Kurein M.N.  
**–í–µ—Ä—Å–∏—è –¥–æ–∫—É–º–µ–Ω—Ç–∞:** 1.0

